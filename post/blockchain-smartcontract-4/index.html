<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ - JMaxU&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="æ™¯æ—­" />
  <meta name="description" content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬ç”¨ä»¥å¤ªåŠæ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„å±äºè‡ªå·±çš„åŒºå—é“¾, ç¼–å†™ä¸€ä¸ªæ•°æ®è®¤è¯çš„æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸Š. ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸è”ç›Ÿé“¾" />

  <meta name="keywords" content="JMaxU, architecture, æ™¯æ—­" />






<meta name="generator" content="Hugo 0.30.2" />


<link rel="canonical" href="http://jmaxu.github.io/post/blockchain-smartcontract-4/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" href="/favicon.ico" />
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=2.7.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">

<meta property="og:title" content="æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾" />
<meta property="og:description" content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬ç”¨ä»¥å¤ªåŠæ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„å±äºè‡ªå·±çš„åŒºå—é“¾, ç¼–å†™ä¸€ä¸ªæ•°æ®è®¤è¯çš„æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸Š. ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸è”ç›Ÿé“¾" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://jmaxu.github.io/post/blockchain-smartcontract-4/" />



<meta property="article:published_time" content="2017-10-29T20:45:37&#43;08:00"/>

<meta property="article:modified_time" content="2017-10-29T20:45:37&#43;08:00"/>











<meta itemprop="name" content="æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾">
<meta itemprop="description" content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬ç”¨ä»¥å¤ªåŠæ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„å±äºè‡ªå·±çš„åŒºå—é“¾, ç¼–å†™ä¸€ä¸ªæ•°æ®è®¤è¯çš„æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸Š. ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸è”ç›Ÿé“¾">


<meta itemprop="datePublished" content="2017-10-29T20:45:37&#43;08:00" />
<meta itemprop="dateModified" content="2017-10-29T20:45:37&#43;08:00" />
<meta itemprop="wordCount" content="2552">



<meta itemprop="keywords" content="åŒºå—é“¾,ä»¥å¤ªåŠ," />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾"/>
<meta name="twitter:description" content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬ç”¨ä»¥å¤ªåŠæ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„å±äºè‡ªå·±çš„åŒºå—é“¾, ç¼–å†™ä¸€ä¸ªæ•°æ®è®¤è¯çš„æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸Š. ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸è”ç›Ÿé“¾"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">JMaxU&#39;s blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">é¦–é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">å½’æ¡£</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">æ ‡ç­¾</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">åˆ†ç±»</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">JMaxU&#39;s blog</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">é¦–é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">åˆ†ç±»</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-10-29 </span>
        <div class="post-category">
            
              <a href="/categories/%E6%8A%80%E6%9C%AF/"> æŠ€æœ¯ </a>
            
          </div>
        <span class="more-meta"> çº¦ 2552 å­— </span>
        <span class="more-meta"> é¢„è®¡é˜…è¯» 6 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾">æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾</a>
<ul>
<li><a href="#å®‰è£…">å®‰è£…</a>
<ul>
<li><a href="#å®‰è£…geth">å®‰è£…geth</a></li>
<li><a href="#å®‰è£…solc">å®‰è£…solc</a></li>
<li><a href="#å¯åŠ¨">å¯åŠ¨</a></li>
</ul></li>
<li><a href="#åˆ›å»ºè´¦æˆ·">åˆ›å»ºè´¦æˆ·</a></li>
<li><a href="#æŒ–ç‚¹çŸ¿">æŒ–ç‚¹çŸ¿</a></li>
<li><a href="#ç¼–å†™ä¸€ä¸ªæ•°å­—è®¤è¯æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°åŒºå—é“¾">ç¼–å†™ä¸€ä¸ªæ•°å­—è®¤è¯æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°åŒºå—é“¾</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬ç”¨ä»¥å¤ªåŠæ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„å±äºè‡ªå·±çš„åŒºå—é“¾, ç¼–å†™ä¸€ä¸ªæ•°æ®è®¤è¯çš„æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸Š.</p>

<blockquote>
<p>ç§æœ‰ç½‘ç»œçš„åŒºå—é“¾ä¸è”ç›Ÿé“¾æ˜¯ä¸åŒçš„æ¦‚å¿µ.
ç§æœ‰ç½‘ç»œåŒºå—é“¾æ˜¯è¯´å»ºç«‹ä¸€æ¡ä¸ä»¥å¤ªåŠå…¬æœ‰é“¾ä¸åŒçš„å¦ä¸€ä¸ªå…¬æœ‰é“¾.
è€Œè”ç›Ÿé“¾æ˜¯æŒ‡åªæœ‰ç‰¹å®šçš„ä¸€äº›äººæ‰å¯ä»¥å‚ä¸çš„åŒºé“¾é“¾.
å¦‚æœæŠŠç§æœ‰ç½‘ç»œçš„åŒºå—é“¾å»ºç«‹åœ¨ä¸€ä¸ªå±€åŸŸç½‘å†…, åªæœ‰å±€åŸŸç½‘å†…çš„äººæ‰èƒ½å‚ä¸, é‚£ä¹ˆè¿™æ ·çš„ç§æœ‰ç½‘ç»œåŒºå—é“¾ä¹Ÿå°±æ˜¯è”ç›Ÿé“¾äº†.</p>
</blockquote>

<h2 id="æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾">æ­å»ºä¸€ä¸ªç§æœ‰ç½‘ç»œçš„åŒºå—é“¾</h2>

<h3 id="å®‰è£…">å®‰è£…</h3>

<h4 id="å®‰è£…geth">å®‰è£…geth</h4>

<p>å®‰è£…ä»¥å¤ªåŠgoè¯­è¨€ç‰ˆå®¢æˆ·ç«¯</p>

<pre><code>sudo yum install golang
sudo yum install gmp-devel
git clone https://github.com/ethereum/go-ethereum
cd go-ethereum/
make geth
ls -al  build/bin/geth
</code></pre>

<p>ä¸­é—´é‡åˆ°iconvåº“çš„é“¾æ¥é—®é¢˜, è§£å†³:</p>

<pre><code>rm /usr/local/include/iconv.h
</code></pre>

<h4 id="å®‰è£…solc">å®‰è£…solc</h4>

<p>åˆçº¦è¯­è¨€Solidityçš„ç¼–è¯‘å™¨</p>

<pre><code>npm install -g solc
</code></pre>

<h4 id="å¯åŠ¨">å¯åŠ¨</h4>

<p>ç§æœ‰ç½‘ç»œå¹¶ä¸æ˜¯ç§é“¾.
åˆ›å»ºæ–‡ä»¶<code>genesis.json</code> ä»¥ä¸‹å†…å®¹</p>

<pre><code>{
    &quot;config&quot;: {
        &quot;chainId&quot;: 11988,
        &quot;homesteadBlock&quot;: 0,
        &quot;eip155Block&quot;: 0,
        &quot;eip158Block&quot;: 0
    },
    &quot;difficulty&quot;: &quot;0x400&quot;,
    &quot;gasLimit&quot;: &quot;0x8000000&quot;,
    &quot;alloc&quot;: {}
}
</code></pre>

<p>å…¶ä¸­</p>

<ul>
<li><code>difficulty</code>ä¸ºåˆå§‹æ‰“åŒ…ä¹Ÿå°±æ˜¯æŒ–çŸ¿çš„éš¾åº¦, å› ä¸ºæ˜¯ç§æœ‰ç½‘ç»œåˆå§‹è®¾ä½ä¸€ç‚¹.</li>
<li><code>chainId</code>é“¾çš„id,ä¸åŒé“¾, é“¾idä¸ä¸€æ ·, å†™ä¸€ä¸ªè‡ªå·±çš„å’Œå…¬æœ‰çš„åŒºåˆ†å¼€.</li>
</ul>

<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–ä¸¤ä¸ªèŠ‚ç‚¹:</p>

<pre><code>geth --datadir ./node1/ init ./genesis.json
geth --datadir ./node2/ init ./genesis.json
</code></pre>

<p>è¿™æ—¶åˆå§‹åŒ–ä¸¤ä¸ªèŠ‚ç‚¹, ä½†å¹¶æ²¡æœ‰å¯åŠ¨.</p>

<p>ä¸ºäº†èŠ‚ç‚¹ä¹‹é—´äº’ç›¸èƒ½çŸ¥é“, ä¸€ç§æ–¹æ³•æ˜¯å¯åŠ¨èŠ‚ç‚¹æ—¶æŒ‡å®š, å¦ä¸€ä¸ªæ˜¯ä½¿ç”¨bootnodeèŠ‚ç‚¹, å¯åŠ¨æ—¶éƒ½è¿æ¥bootnodeèŠ‚ç‚¹, è¿™æ ·å°±å¯ä»¥ä»bootnodeä¸­è·å¾—å…¶ä»–èŠ‚ç‚¹çš„ä¿¡æ¯.</p>

<p>å¯åŠ¨bootnode</p>

<pre><code>bootnode -genkey bootnode.key
bootnode -nodekey bootnode.key -addr &quot;:9100&quot; -verbosity 6
</code></pre>

<p>ç¬¬ä¸€æ¡å‘½ä»¤ç”Ÿæˆkey, æˆ‘ç†è§£å°±æ˜¯è¿™ä¸ªbootnodeçš„id.
ç¬¬äºŒæ¡å‘½ä»¤æ˜¯å¯åŠ¨bootnodeèŠ‚ç‚¹.</p>

<p>å¯åŠ¨è¿™ä¸¤ä¸ªèŠ‚ç‚¹</p>

<pre><code>geth --networkid 11988 --datadir ./node1/ --syncmode &quot;full&quot; --rpc --rpcapi db,eth,net,web3,personal --port 19101 --rpcport 9101 --rpcaddr 127.0.0.1 --rpccorsdomain &quot;*&quot; -bootnodes enode://8f10b7c8ecb0b04baac38c0d17e7ebe1e15320b19ccc36ad90aa197c02346e46bcc9d2d058cdd401f8e1cf928b724178c673a9c5df3395131e808e76620a2656@127.0.0.1:9100
geth --networkid 11988 --datadir ./node2/ --syncmode &quot;full&quot; --rpc --rpcapi db,eth,net,web3,personal --port 19102 --rpcport 9102 --rpcaddr 127.0.0.1 --rpccorsdomain &quot;*&quot; --bootnodes &quot;enode://8f10b7c8ecb0b04baac38c0d17e7ebe1e15320b19ccc36ad90aa197c02346e46bcc9d2d058cdd401f8e1cf928b724178c673a9c5df3395131e808e76620a2656@127.0.0.1:9100&quot;
</code></pre>

<p>å…¶ä¸­</p>

<ul>
<li><code>networdid</code>ä¹ŸchainIdç›¸åŒ.</li>
<li><code>port</code>æŒ‡å®šèŠ‚ç‚¹é—´äº’ç›¸é€šè¿‡çš„ç«¯å£.</li>
<li><code>rpcport</code>æŒ‡å®šèŠ‚ç‚¹å¯¹å¤–æš´éœ²çš„æ¥å£æ‰€ç”¨çš„ç«¯å£.</li>
</ul>

<h3 id="åˆ›å»ºè´¦æˆ·">åˆ›å»ºè´¦æˆ·</h3>

<p>å¯åŠ¨ååœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ªgeth.ipcæ–‡ä»¶, è¿™ä¸ªæ–‡ä»¶ç”¨æ¥è¿æ¥èŠ‚ç‚¹æ—¶ç”¨.</p>

<p>è¿æ¥èŠ‚ç‚¹åˆ›å»ºå¤–éƒ¨è´¦æˆ·</p>

<pre><code>geth attach /home/dev/git/blockchain/my-private-ethereum/node1/geth.ipc
web3.eth.accounts
personal.newAccount()
web3.eth.accounts
eth.getBalance(web3.eth.accounts[0])
</code></pre>

<p>è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªè´¦æˆ·, åˆšåˆ›å»ºçš„è´¦æˆ·çš„ä½™é¢ä¸º0.</p>

<h3 id="æŒ–ç‚¹çŸ¿">æŒ–ç‚¹çŸ¿</h3>

<p>ä¸ºäº†æç‚¹ä½™é¢æˆ‘ä»¬å¯ä»¥è¿›è¡ŒæŒ–çŸ¿
å¼€å§‹æŒ–çŸ¿</p>

<pre><code>miner.start()
</code></pre>

<p>å¯ä»¥åœ¨node1èŠ‚ç‚¹çš„æ—¥å¿—ä¸­çœ‹åˆ°å¦‚ä¸‹:</p>

<pre><code>INFO [12-28|15:53:50] ğŸ”— block reached canonical chain          number=5  hash=4a6b09â€¦5f5812
INFO [12-28|15:53:50] ğŸ”¨ mined potential block                  number=10 hash=f4c71bâ€¦518dfb
INFO [12-28|15:53:50] Commit new mining work                   number=11 txs=0 uncles=0 elapsed=127.859Âµs
INFO [12-28|15:53:50] Generating DAG in progress               epoch=1 percentage=47 elapsed=19.980s
INFO [12-28|15:53:51] Successfully sealed new block            number=11 hash=71d1eeâ€¦1aa278
INFO [12-28|15:53:51] ğŸ”— block reached canonical chain          number=6  hash=6e7a6eâ€¦a7774d
INFO [12-28|15:53:51] ğŸ”¨ mined potential block                  number=11 hash=71d1eeâ€¦1aa278
INFO [12-28|15:53:51] Commit new mining work                   number=12 txs=0 uncles=0 elapsed=125.815Âµs
INFO [12-28|15:53:51] Generating DAG in progress               epoch=1 percentage=48 elapsed=20.811s
INFO [12-28|15:53:51] Successfully sealed new block            number=12 hash=6009b7â€¦506641
INFO [12-28|15:53:51] ğŸ”— block reached canonical chain          number=7  hash=2116bbâ€¦8e6948
INFO [12-28|15:53:51] ğŸ”¨ mined potential block                  number=12 hash=6009b7â€¦506641
INFO [12-28|15:53:51] Commit new mining work                   number=13 txs=0 uncles=0 elapsed=157.238Âµs
INFO [12-28|15:53:51] Successfully sealed new block            number=13 hash=cf04e9â€¦baac3b
INFO [12-28|15:53:51] ğŸ”— block reached canonical chain          number=8  hash=011c78â€¦454cf2
INFO [12-28|15:53:51] ğŸ”¨ mined potential block                  number=13 hash=cf04e9â€¦baac3b
</code></pre>

<p>ç”±äºæˆ‘ä»¬åœ¨genesis.jsoné…ç½®åˆå§‹æŒ–çŸ¿éš¾åº¦å€¼å¾ˆä½, æ‰€ä»¥æˆ‘ä»¬å‡ ä¹æŒ–çŸ¿é€Ÿåº¦å¾ˆå¿«.
è¿™æ—¶å†æŸ¥çœ‹ä½™é¢</p>

<pre><code>eth.getBalance(web3.eth.accounts[0])
45000000000000000000
</code></pre>

<p>å‘ç°ä½™é¢å·²ç»å¢åŠ äº†. è¿™é‡Œæ˜¾ç¤ºçš„å•ä½ä¸ºwei. ç›¸å½“äº45ä¸ªä»¥å¤ªå¸.</p>

<blockquote>
<p>ä»¥å¤ªçš„è½¬æ¢å¯ä»¥ä½¿ç”¨è¿™ä¸ªç½‘å€:<a href="https://etherconverter.online/">https://etherconverter.online/</a></p>
</blockquote>

<p>ç°åœ¨æˆ‘ä»¬æœ‰é’±äº†, é‚£å°±å¯ä»¥éƒ¨ç½²å’Œæ‰§è¡Œåˆçº¦.
æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€ä¸ªæ•°å­—è®¤è¯çš„åˆçº¦, å¹¶éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Š.</p>

<h3 id="ç¼–å†™ä¸€ä¸ªæ•°å­—è®¤è¯æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°åŒºå—é“¾">ç¼–å†™ä¸€ä¸ªæ•°å­—è®¤è¯æ™ºèƒ½åˆçº¦å¹¶éƒ¨ç½²åˆ°åŒºå—é“¾</h3>

<p><strong>å®‰è£…web3ç¯å¢ƒ</strong></p>

<p>web3ç›¸å½“äºä¸€ä¸ªé¢å¯¹æœ¬åœ°åŒºå—é“¾èŠ‚ç‚¹çš„javascriptå®¢æˆ·ç«¯.</p>

<pre><code>npm install web3@0.20.1 solc
</code></pre>

<p>æ™ºèƒ½åˆçº¦å¦‚ä¸‹:</p>

<pre><code>pragma solidity ^0.4.0;
// æ•°å­—è®¤è¯ å­˜åœ¨è¯æ˜
contract ProofOfExistence {

    mapping (bytes32 =&gt; bool) proofs;

    // å­˜å‚¨è¯æ˜åˆ°åˆçº¦ä¸­
    function storeProof(bytes32 proof) {
        proofs[proof] = true;
    }

    // æ£€æŸ¥è¯æ˜æ˜¯å¦å­˜åœ¨
    function hasProof(bytes32 proof) returns (bool) {
        return proofs[proof];
    }
}
</code></pre>

<p>æ•°å­—è¯æ˜å¾ˆç®€å•, æˆ‘ä»¬åªè¦æŠŠéœ€è¦è¯æ˜çš„æ•°æ®çš„hashå€¼è®°è¿›åŒºå—é“¾ä¸­, åˆ©ç”¨hashçš„ç¢°æ’é˜»åŠ›ç‰¹æ€§, è¯æ˜æŸæ®µæ•°æ®çš„å­˜åœ¨.</p>

<p><strong>éƒ¨ç½²åˆçº¦</strong></p>

<p>nodeè¿›å…¥</p>

<pre><code>Web3 = require('web3')
//9102ä¸ºå¯åŠ¨èŠ‚ç‚¹æ—¶è®¾ç½®çš„æ¥å£æ‰€ç”¨çš„ç«¯å£
web3 = new Web3(new Web3.providers.HttpProvider(&quot;http://localhost:9101&quot;));
//æŸ¥ä¸€ä¸‹æœ‰æ²¡æœ‰è´¦æˆ·
web3.eth.accounts
//åˆ›å»ºä¸€ä¸ªè´¦æˆ·, å¦‚æœæ²¡æœ‰çš„è¯, ç”±äºæˆ‘ä»¬å·²ç»ç”¨gethåˆ›å»ºäº†æ‰€ä»¥è¿™é‡Œæ˜¯æœ‰è´¦æˆ·çš„
web3.personal.newAccount('abcd')
//å†æ¬¡è°ƒç”¨, å‘ç°æœ‰äº†è´¦æˆ·
web3.eth.accounts
//æŸ¥çœ‹ä½™é¢, ç”±äºæˆ‘ä»¬æŒ–äº†ä¼šçŸ¿, æ‰€ä»¥è´¦æˆ·æ˜¯æœ‰ä½™é¢çš„
web3.eth.getBalance(web3.eth.accounts[0])
//è§£é”è´¦æˆ·, å¦‚æœæ²¡æœ‰è§£é”çš„è¯
web3.personal.unlockAccount(web3.eth.accounts[0], 'abcd', 15000)
//è¯»å–åˆçº¦ä»£ç 
code = fs.readFileSync('ProofOfExistence.sol').toString()
//åŠ è½½solidityç¼–è¯‘å™¨
solc = require('solc')
//ç¼–è¯‘ä»£ç 
compiledCode = solc.compile(code)
//ç”Ÿæˆabi
abiDefinition = JSON.parse(compiledCode.contracts[':ProofOfExistence'].interface)
//åˆ›å»ºåˆçº¦
VotingContract = web3.eth.contract(abiDefinition)
//æ‹¿åˆ°åˆçº¦å­—èŠ‚ç 
byteCode = compiledCode.contracts[':ProofOfExistence'].bytecode
//å°†åˆçº¦å­—èŠ‚ç  éƒ¨ç½²åˆ°åŒºå—é“¾
deployedContract = VotingContract.new({data: '0x' + byteCode, from: web3.eth.accounts[0], gas: 5000000})
//æŸ¥çœ‹åˆçº¦åœ°å€, ä¼šå‘ç°åˆçº¦åœ°å€ä¸ºç©º, è¿™é‡Œå› ä¸ºåˆçº¦å°šæœªæ‰“åŒ…åˆ°åŒºå—é‡Œ, è¿™é‡Œé‡å¯å¼€å¯æŒ–çŸ¿æ¥æ‰“åŒ…åŒºå—. å†æ¬¡æŸ¥çœ‹å°±æœ‰åœ°å€äº†
deployedContract.address
</code></pre>

<p><strong>è°ƒç”¨åˆçº¦</strong></p>

<pre><code>//æ‹¿åˆ°åˆçº¦å®ä¾‹
contractInstance = VotingContract.at(deployedContract.address)
//è°ƒç”¨åˆçº¦æ–¹æ³•, å‚æ•°ä¸­çš„hashå€¼æ˜¯é€šè¿‡è°ƒç”¨phpæ–¹æ³•hash(&quot;sha256&quot;, &quot;abcdefgxxxåˆåŒ&quot;)è·å¾—çš„
contractInstance.storeProof(0x27a2df9c083e06109dfeb9633c711b796e0bd85ac049f5f55646d31def21b833)
//å¦‚æœæŠ¥invalid address, é‚£æ˜¯å› ä¸ºé»˜è®¤çš„äº¤æ˜“å‘é€è€…, æ‰§è¡Œä»¥ä¸‹, å†æ‰§è¡Œä»¥ä¸Šå‘½ä»¤å°±å¥½äº†
web3.eth.defaultAccount = web3.eth.accounts[0]
//contractInstance.storeProofæ‰§è¡ŒæˆåŠŸå, ä¼šè¿”å›ä¸€ä¸ªåœ°å€, è¿™ä¸ªåœ°å€ä¸ºè¿™æ¬¡äº¤æ˜“çš„åœ°å€, æ‰§è¡Œä»¥ä¸‹å¯ä»¥æŸ¥çœ‹è¿™ä¸ªäº¤æ˜“
web3.eth.getTransaction('äº¤æ˜“åœ°å€')
//è¿”å›å¦‚ä¸‹ç»“æœ
{ blockHash: '0x0000000000000000000000000000000000000000000000000000000000000000',
  blockNumber: null,
  from: '0xb19c93e4ed8553f0c8bbef8a59deba54215695bb',
  gas: 90000,
  gasPrice: BigNumber { s: 1, e: 10, c: [ 18000000000 ] },
  hash: '0xcafc78b00868c7bd45ecbb7b9e8cf4fa4f68aa10246c76319757202af1633175',
  input: '0x8952877b27a2df9c083e05f415c1c1c1ce3059e749c7a4ff96d5b08b3000000000000000',
  nonce: 1,
  to: '0x1efe34a3fe3b46e59fed454e86dfead63efd243d',
  transactionIndex: 0,
  value: BigNumber { s: 1, e: 0, c: [ 0 ] },
  v: '0x5dcb',
  r: '0x3cf890381f951e1aeec61d61646be95926be8dd0436829674f3d60eb8fcf4ad5',
  s: '0x6070af4a62306071677db9aa0016ea4e9dc4d78a76a97a108203f47f232a8f87' }
//blockHashä¸º0000...æ˜¯å› ä¸ºå°šæœªæ‰“åŒ…, ç°åœ¨æ²¡æœ‰blockhash. å¯åŠ¨çŸ¿å·¥å†æ¬¡æ‰“åŒ…, åå†æ‰§è¡Œ, ç»“æœå¦‚ä¸‹
{ blockHash: '0xf770e050eb0edde3ac6a9501790ec66f4d239978c3374e98940e2bcd8c2d8a90',
  blockNumber: 36,
  from: '0xb19c93e4ed8553f0c8bbef8a59deba54215695bb',
  gas: 90000,
  gasPrice: BigNumber { s: 1, e: 10, c: [ 18000000000 ] },
  hash: '0xcafc78b00868c7bd45ecbb7b9e8cf4fa4f68aa10246c76319757202af1633175',
  input: '0x8952877b27a2df9c083e05f415c1c1c1ce3059e749c7a4ff96d5b08b3000000000000000',
  nonce: 1,
  to: '0x1efe34a3fe3b46e59fed454e86dfead63efd243d',
  transactionIndex: 0,
  value: BigNumber { s: 1, e: 0, c: [ 0 ] },
  v: '0x5dcb',
  r: '0x3cf890381f951e1aeec61d61646be95926be8dd0436829674f3d60eb8fcf4ad5',
  s: '0x6070af4a62306071677db9aa0016ea4e9dc4d78a76a97a108203f47f232a8f87' }
//å¯ä»¥çœ‹åˆ°blockHashæœ‰å€¼.
//å’±ä»¬å†æ¬¡è°ƒç”¨å¦å¤–çš„hasProofæ–¹æ³•çœ‹çœ‹, å¦‚ä¸‹
contractInstance.hasProof(0x27a2df9c083e06109dfeb9633c711b796e0bd85ac049f5f55646d31def21b833)
//å‘ç°åˆè¿”å›äº†ä¸ªäº¤æ˜“åœ°å€, æˆ‘ä»¬çš„hashProofåªæ˜¯ä¸ªæŸ¥è¯¢æ–¹æ³•, æ²¡å¿…é¡»å‘èµ·äº¤æ˜“, ç”¨å¦‚ä¸‹æ–¹å¼æ¥æŸ¥è¯¢
contractInstance.hasProof.call(0x27a2df9c083e06109dfeb9633c711b796e0bd85ac049f5f55646d31def21b833).toLocaleString()
//è¿”å›true, è¯æ˜åŒºå—é“¾é‡Œæœ‰è¿™ä¸ªkey, ä¹Ÿå°±è¿›è¡Œäº†æ•°æ®è¯æ˜
</code></pre>

<p><strong>åœ¨ä»¥å‰, æœ‰å¾ˆå¤šåŒå­¦ç›´æ¥ç”¨gethéƒ¨ç½², ç›®å‰ç”±äºweb3.eth.compile.solidityå·²åœ¨1.6ç‰ˆæœ¬å»æ‰, æ‰€ä»¥ä»¥ä¸‹æ–¹å¼å·²åºŸå¼ƒ.</strong></p>

<pre><code>var proofOfExistence = 'contract ProofOfExistence { mapping (bytes32 =&gt; bool) proofs;  function storeProof(bytes32 proof) { proofs[proof] = true; }  function hasProof(bytes32 proof) returns (bool) { return proofs[proof]; } }';
var proofCompiled = web3.eth.compile.solidity(proofOfExistence)
proofCompiled
var proofContract = web3.eth.contract(proofCompiled.ProofOfExistence.info.abiDefinition);
var proofHash = '27a2df9c083e06109dfeb9633c711b796e0bd85ac049f5f55646d31def21b833'
var proof = proofContract.new(proofHash, {from: eth.accounts[0], data: proofCompiled.ProofOfExistence.code, gas: 4000000},
  function(e, contract) {
    if (!e) {
      if (!contract.address) {
        console.log(&quot;Contract transaction send: TransactionHash: &quot; +
          contract.transactionHash + &quot; waiting to be mined...&quot;);
      } else {
        console.log(&quot;Contract mined! Address: &quot; + contract.address);
        console.log(contract);
      }
    }
  })
</code></pre>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">æ™¯æ—­</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">2017-10-29</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">åŒºå—é“¾</a>
          
          <a href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/">ä»¥å¤ªåŠ</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/blockchain-smartcontract-3/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">åŒºå—é“¾æ™ºèƒ½åˆçº¦ç‰¹ç‚¹</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        
          <a class="next" href="/post/blockchain-smartcontract-1/">
            <span class="next-text nav-default">æ¯”ç‰¹å¸ä¸­çš„æ™ºèƒ½åˆçº¦</span>
            <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        
  

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:woshijingxu@gmail.com" class="iconfont icon-email" title="email"></a>
  <a href="http://jmaxu.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2017 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">æ™¯æ—­</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/even.min.js?v=2.7.0"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?d810cee368eb12bfc47ed60da16a3214";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>


</body>
</html>
